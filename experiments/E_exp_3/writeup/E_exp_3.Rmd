---
title: "Experiment 4 of 4"
author: "Matt Green"
output:
  html_document:
    toc: true
    <!--toc_float: true-->
    mathjax: default
    template: default
    <!--code_folding: hide-->
    theme: default
---  
<style>
table, th, td {
    border: 1px grey;
    border-collapse: collapse;
    padding:2px 5px 2px 5px
}  
</style>

```{r libs, message=FALSE}
library(knitr); library(MASS); library(ggplot2); library(lme4); library(xtable); library(plyr); library(lattice); library(LMERConvenienceFunctions); library(car); library(grid); library(lmerTest); library(reshape2); library(ggplot2); library(languageR); library(pander); source('summarySEwithin2.R')
```

# Experiment 4

Each subject saw 192 trials, being 3 cycles of 64 trials. There were 40 subjects. There were 7680 rows in the full data.

# Trial Procedure
First an instruction was presented until subjects dismissed it with a key press. Then a grey screen was presented for 1 second. Then a prime was presented for 2 seconds. Then a grey screen was presented for 1 second. Then the squares with dots were presented until the subject responded, with a 10 second timeout if they did not respond.

<figure>
<img src="./E_exp_3-flow.jpg" alt="flow-of-D_exp_3" style="width:480px;height:300px;">
<figcaption>Flow of experiment E_exp_3.</figcaption>
</figure>

# Describe the data

Here is a description of each column in the raw data.

* **Sub** identifier for subject. There are 40 subjects.
* **Trl** identifier for the trial. There are 64 Trials for each subject.
* **Itm** identifier for item. There are 4 items. An item is a set of Selections for the dots in the squares, e.g., Item 1 is (6,15,24) in any order. This should be included as a (possibly ordered) factor because the task will probably take longer for more dots. Include this in the final model if it does increase rt. Table below shows the dots for each item.
* **Cnd** just a single vector for the combination of vagueness and selection. Useful for some plotting routines that don't accept pairs of grouping variables. 
* **Ord** whether the order was for example (6,15,24) or (24,14,6). This matters because when the smaller quantity is on the left people are quicker than when the smaller quantity is on the right (i.e, SNARC effect). It is a control variable rather than a direct predictor. It could be left out of the main model assuming it is non-significant.
* **Qty** whether the instruction identifies bigger or smaller quantities. This is a factor with 2 levels sum coded. An example of bigger is _"Choose a square with more dots than the target"_. An example of smaller is _"Choose a square with fewer dots than the target"_.
* **Prm** how many dots there were in the prime (prime is _target_ in the instructions to the participants). Primes were 6 10 16 20 24 26 30 34 36 40 44 50 54.
* **Lft** how many dots there were in the left square
* **Mid** how many dots there were in the middle square
* **Rgt** how many dots there were in the right-hand side square
* **key** which key the subject pressed as a response on a trial.
* **rt** raw response time in milliseconds
* **Ins** a character array for the instruction that was presented to the subject on that trial. Table below shows an example of an instruction in each condition.
* **V** factor for vagueness with 2 levels sum coded
* **S** factor for selection task with 2 levels sum coded

Here is a table of instructions.

<!-- <style type="text/css"> -->
<!-- .table {width: 50%;} -->
<!-- </style> -->

vagueness | selection | instruction
----------|-----------|--------------------------------------------------------------------
crisp     | match     | Choose a square with the same number of dots as the target  
crisp     | compare   | Choose a square with fewer dots than the target 
vague     | match     | Choose a square with about the same number of dots as the target 
vague     | compare   | Choose a square with far fewer dots than the target 

Item   | dots
-------|-----------
Item 1 | (6,15,24)
Item 2 | (16,25,34)
Item 3 | (26,35,44)
Item 4 | (36,45,54)

```{r getdata}
rawdata <- read.table('data.txt')
```

```{r targets}
target <- subset(rawdata, subset= Item=="06:15:24" & Quantity=="Small")
target2 <- subset(target, select=c(Item, Condition, Ins, Target))
target3 <- unique(target2[order(target$Condition),] )
row.names(target3) <- NULL
pander(target3)
```

```{r trimat25sd}
trimdata <- perSubjectTrim.fnc(rawdata, response='RT', subject='Subject', trim = 2.5)$data
rtdata <- trimdata
```

```{r computeSummariesForGraphs, cache=TRUE, message=FALSE}
rtdataplot1 <- summarySEwithin2(rtdata, measurevar="RT_log", withinvars=c("Condition", "Vagueness", "Selection", "Item"), idvar="Subject")
```

```{r rtplot, fig.width=7, fig.height=3, echo=F}
dodge = position_dodge(width=0.2)
rtdataplot1$Condition <- as.factor(paste(sep=' ', rtdataplot1$Selection, rtdataplot1$Vagueness))
rtplot=ggplot(rtdataplot1, aes(y=RT_logNormed, x=Item, ymin=RT_logNormed-ci, ymax=RT_logNormed+ci,
                group=Condition, shape=Condition, fill=Condition)) +
  geom_line(position=dodge) +
  geom_errorbar(width=.2, position=dodge) +
  geom_point(size=2, position=dodge) +
  scale_shape_manual("",values = c(22, 22, 21, 21)) +
  scale_fill_manual("",values=c("black","white","black","white")) +
  ggtitle("Response time") +
  ylab("Respone time (log (ms))") + 
  xlab("") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        legend.key = element_blank(), aspect.ratio=1,
        axis.text.x = element_text(angle = 45, hjust = 1),
        plot.background=element_rect(fill=NA, color='white')) +
  facet_grid(~Selection) 
rtplot
```

```{r rtlmer, cache=TRUE}
rtlmer = lmerTest::lmer(data=rtdata,
                        RT_log ~ c_Vag * c_Sel + c_Itm +
                          (1 + c_Vag * c_Sel + c_Itm | Subject))
```

```{r rtlmersummaryxtable, results='asis', cache=TRUE, echo=F}
print(xtable(summary(rtlmer)$coef, digits=c(0,2,2,1,1,4)),type='html')
```

```{r seplmersforcomparison, results='asis', cache=TRUE, echo=-3}
s1 <- subset(rtdata, subset=Selection=='Comparison')
s1lm <- lmerTest::lmer(data=s1, RT_log ~ c_Vag + c_Itm + (1 + c_Vag + c_Itm | Subject))
print(xtable(summary(s1lm)$coef, digits=c(0,2,2,1,1,4)), type='html')
```

```{r seplmersformatching, results='asis', cache=TRUE, echo=-3}
s2 <- subset(rtdata, subset=Selection=='Matching')
s2lm <- lmerTest::lmer(data=s2, RT_log ~ c_Vag + c_Itm + (1 + c_Vag + c_Itm | Subject))
print(xtable(summary(s2lm)$coef, digits=c(0,2,2,1,1,4)), type='html')
```
