```{r, loadLibraries, echo=FALSE}
# Load libraries.
suppressPackageStartupMessages(library(MASS))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(lme4))
suppressPackageStartupMessages(library(xtable))
suppressPackageStartupMessages(library(plyr))
suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(lattice))
suppressPackageStartupMessages(library(latticeExtra))
suppressPackageStartupMessages(library(LMERConvenienceFunctions))
suppressPackageStartupMessages(library(car))
suppressPackageStartupMessages(library(grid))
suppressPackageStartupMessages(library(lmerTest))
```

Compare distributions of the various transformations of RT against random samples from normal distributions with the same mean and sd to see which transformations best approximate normal distributions.

```{r foo,fig.width=20, fig.height=12, message=FALSE}
## plot the comparison of the transformations against their normal equivalents to see distributional properties using full data

# first create a data frame specially for transformations
# this won't be used for analysis, just for this plot
dat_transforms <- dat

# dfSubset says whether any data points were removed
dat_transforms$dfSubset <- "original"

# RTtype says whether the row contains data for an observed RT or 
# a sample from a normal distribution with the same mean and sd
dat_transforms$RTtype <- "observed"

# create extra rows for dfs with removed (outlier) data points
dat1 <- dat_transforms                                       # nrow 7680
dat2 <- subset(dat_transforms, RT<9000)              # nrow 7677
dat2$dfSubset <- "RT<9000"

# bring the dfs back into main df
dat_transforms <- rbind(dat1,dat2)
dat_transforms$dfSubset <- factor(dat_transforms$dfSubset, levels=c("original", "RT<9000"))

# create extra rows for normally distributed transformed variables
dato = dat_transforms
datn = dat_transforms; datn$RTtype <- "normal"
dat_transforms <- rbind(dato,datn)
dat_transforms$RTtype <- factor(dat_transforms$RTtype, levels=c("observed","normal"))

# for safety
dat_transforms[dat_transforms$RTtype=="normal", c("RT_RecSqd", "RT_Rec", "RT_RecSqt", "RT_log", "RT_sqt", "RT_raw", "RT_sqd")] <- NA

# Create the normally distributed transformed variables, replacing the NAs declared above
for (k in levels(dat_transforms$dfSubset)){
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_RecSqd"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_RecSqd"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_RecSqd"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_RecSqd"]))
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_Rec"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_Rec"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_Rec"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_Rec"]))
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_RecSqt"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_RecSqt"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_RecSqt"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_RecSqt"]))
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_log"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_log"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_log"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_log"]))
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_sqt"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_sqt"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_sqt"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_sqt"]))
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_raw"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_raw"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_raw"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_raw"]))
  dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="normal", "RT_sqd"]  <- 
    rnorm(n=length(dat_transforms[dat_transforms$dfSubset==k    & dat_transforms$RTtype=="observed", "RT_sqd"]), 
          mean=mean(dat_transforms[dat_transforms$dfSubset==k & dat_transforms$RTtype=="observed", "RT_sqd"]), 
          sd=sd(dat_transforms[dat_transforms$dfSubset==k     & dat_transforms$RTtype=="observed", "RT_sqd"]))
}

temp <- reshape2::melt(data=dat_transforms, 
             id.vars=c("dfSubset", "RTtype", "Item", "Vagueness", "Selection", "Quantity", "Order"),
             measure.vars=c("RT_RecSqd", "RT_Rec", "RT_RecSqt", "RT_log", "RT_sqt", "RT_raw", "RT_sqd"))

ggplot(temp, 
			 aes(value, colour=RTtype)) + 
	geom_freqpoly() + 
  facet_wrap(dfSubset~variable, scales="free", nrow=2) +
  theme_bw() + theme(aspect.ratio=1) + scale_color_manual(values=c("blue","red"))
```

Show how transformations of RT affect distribution of times, and how they affect which times are outliers.

```{r bar, fig.width=20, fig.height=5}
# boxplot subjects and items
load("data.Rda")
# allow reference to transformation
subdata = melt(dd,
               measure.vars=c("RT_Rec", "RT_RecSqt", "RT_log", "RT_raw")) 
# boxplots for subjects and items separately for each dependent variable
ggplot(subdata) + 
  facet_wrap(~ variable, scales="free", ncol=4) +
  geom_boxplot(aes(y=value, x=Item, col="Items")) + 
  geom_boxplot(aes(y=value, x=Subject, col="Subjects")) + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1), aspect.ratio=1, panel.grid=element_blank()) + 
  scale_colour_manual("",values=c("Items"="red","Subjects"="blue")) +
  xlab("") + ylab("")
```

Show how mean times for individual subjects and items vary with respect to the grand mean RT.

```{r, bar2, fig.width=10, fig.height=5}
# Show how mean times for individual subjects and items vary with respect to the grand mean RT.
subs=ddply(dd, .(level=Subject), summarise, effect="subject", emean=mean(dd$RT), lmean=mean(RT), ldiff=mean(RT)-mean(dd$RT), lsign=ifelse(mean(RT)-mean(dd$RT)>0,"slow","fast"))
itms=ddply(dd, .(level=Item), summarise, effect="item", emean=mean(dd$RT), lmean=mean(RT), ldiff=mean(RT)-mean(dd$RT), lsign=ifelse(mean(RT)-mean(dd$RT)>0,"slow","fast"))
si=rbind(subs,itms)
si$effect <- factor(si$effect, levels=c("subject", "item"))
si$lsign <- factor(si$lsign, levels=c("slow","fast"))

my1 <- xyplot(data=si, lmean~level | effect, 
              aspect=1,
              layout=c(2,1),
              ylim = extendrange(si$lmean, f = 0.10),
              par.settings=list(trellis.par.set(superpose.symbol = list(col = c("blue","red"), pch=19), superpose.line=list(col = c("blue","red")))),
              groups=si$lsign,
              xlab=NULL,
              ylab="RT (in ms)",
              key=list(text=list(levels(si$lsign)), lines=list(lty=c(1,1), col=trellis.par.get('superpose.line')$col, pch=c(19,19), type='o'), divide=1),
              mean=unique(si$emean),
              scales=list(x=list(relation="free", at=list(15.5, 32.5), labels=list("subject number", "item identifier"), cex=1 ), 
                          y=list(at=c(0, 2000, unique(si$emean), 4000, 6000, 8000,  10000), labels=c(0, 2000,  "Mean", 4000,  6000, 8000, 10000), cex=.9) ),
              panel=function(x,y,type,subscripts,groups=groups,...){
                panel.xyplot(x,y,type='p',groups=groups, subscripts=subscripts,...)
                panel.arrows(x0=x, y0=unique(si$emean), x1=x, y1=y, groups=groups, subscripts=subscripts, code=3, length=0, col=trellis.par.get('superpose.line')$col[groups][subscripts], ...)
                panel.abline(h=unique(si$emean), col="lightgrey",lty=1)
                panel.text(x, y=(ifelse(y<unique(si$emean),y-200,y+200)), as.numeric(si$level)[subscripts][panel.number()==1], cex=.75)
                panel.text(x, y=(ifelse(y<unique(si$emean),y-200,y+200)), as.character(si$level)[subscripts][panel.number()==2], cex=.75)
              })

my2 <- xyplot(data=si, ldiff~level | effect, 
              aspect=1, type='n',
              ylab="Deviation from mean RT (in ms)",
              ylim=extendrange(si$ldiff,f=0.10))

print(doubleYScale(my1, my2, add.axis=TRUE, add.ylab2=TRUE, use.style=FALSE))
```

Show how practice and fatigue effects vary over subjects

```{r barr3, eval=TRUE, fig.width=20, fig.height=10, cache=FALSE, echo=TRUE}
# Show how practice/fatigue effects vary over subjects
ggplot(dd, aes(y=RT_log, x=Trial)) + facet_wrap(~Subject,nrow=3) + theme(panel.grid=element_blank(), panel.margin = unit(0, "lines"), panel.background= element_rect(fill = 'white', colour='black' ), legend.position="top") + scale_x_continuous("Trial", breaks=NULL) + geom_point(pch=19, cex=.25, alpha=.5) + stat_smooth(fill='lightblue',col="red",lwd=.5, show.legend=TRUE) + theme(aspect.ratio = 1) 
```

Show practice and fatigue effects vary over items.

```{r, var3, eval=TRUE, fig.width=9, fig.height=4, cache=FALSE, echo=TRUE}
# Show how practice/fatigue effects vary over items
ggplot(dd, aes(y=RT_log, x=Trial)) + facet_grid(~Item) + theme(panel.grid=element_blank(), panel.margin = unit(0, "lines"), panel.background= element_rect(fill = 'white', colour='black' ), legend.position="top") + scale_x_continuous("Trial") + geom_point(pch=19, cex=.25, alpha=.5) + stat_smooth(fill='lightblue',col="red",lwd=.5, show.legend=TRUE) + theme(aspect.ratio = 1) 
```


# Show means.

Main effects

```{r, bar4}
# prep main effects rts data frame
vrts <- cbind(Effect="Vagueness",x=factor(c(1,2)),summarySEwithin2(dd, measurevar="RT_log", withinvars=c("Vagueness"), idvar = "Subject"));names(vrts)[3]<-"Levels"
nrts <- cbind(Effect="Selection",x=factor(c(1,2)), summarySEwithin2(dd, measurevar="RT_log", withinvars=c("Selection"), idvar = "Subject"));names(nrts)[3]<-"Levels"
qrts <- cbind(Effect="Quantity",x=factor(c(1,2)), summarySEwithin2(dd, measurevar="RT_log", withinvars=c("Quantity"), idvar = "Subject"));names(qrts)[3]<-"Levels"
orts <- cbind(Effect="Order",x=factor(c(1,2)), summarySEwithin2(dd, measurevar="RT_log", withinvars=c("Order"), idvar = "Subject"));names(orts)[3]<-"Levels"
irts <- cbind(Effect="Item",x=factor(c(1,2,3,4)), summarySEwithin2(dd, measurevar="RT_log", withinvars=c("Item"), idvar = "Subject"));names(irts)[3]<-"Levels"
rts=rbind(vrts,nrts,qrts,orts)
rts$mins=rts$RT_log-rts$ci
rts$maxs=rts$RT_log+rts$ci

# plot main effects
ggplot(rts, aes(y=RT_log, x=Levels, group=1, ymin=mins, ymax=maxs)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Effect, scale="free_x") + 
  theme_bw() +
  theme(aspect.ratio=1) 
```

Main effects over items

```{r, bar5, message=FALSE, fig.width=10, fig.height=3}
vrts <- cbind(Effect="Vagueness",x=factor(c(1,2)),summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio","Vagueness")));names(vrts)[4]<-"Levels"
nrts <- cbind(Effect="Selection",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio","Selection")));names(nrts)[4]<-"Levels"
qrts <- cbind(Effect="Quantity",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio","Quantity")));names(qrts)[4]<-"Levels"
orts <- cbind(Effect="Order",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio","Order")));names(orts)[4]<-"Levels"

rts=rbind(vrts,nrts,qrts,orts)
rts$mins=rts$RT_log-rts$ci
rts$maxs=rts$RT_log+rts$ci

rts$item_mean_ratio <- as.numeric(as.character(rts$item_mean_ratio))

ggplot(rts, aes(y=RT_log, x=item_mean_ratio, group=Levels, ymin=mins, ymax=maxs, shape=Levels, fill=Levels, col=Levels)) +
  scale_shape_manual(values=c(21,21,22,22,23,23,24,24)) +
  scale_fill_manual(values=c("black","gray","black","gray","black","gray","black","gray")) +
  scale_color_manual(values=c("black","gray","black","gray","black","gray","black","gray")) +
  geom_line() +
  geom_errorbar(width=.01) +
  geom_point(cex=3) + 
  facet_grid(~Effect) + 
  theme_bw() +
  theme(aspect.ratio=1, 
        panel.grid=element_blank()) +
  scale_x_continuous(breaks = round(sort(unique(rts$item_mean_ratio)),1)) 
```

2 way interactions ignoring item

```{r, bar6}
# prep 2 ways rts data frame
rts1 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("Vagueness","Selection")); names(rts1)[1] <- "F1"; names(rts1)[2] <- "F2"
rts1$Effect <- rep("Vagueness:Selection",4)
rts2 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("Vagueness","Quantity")); names(rts2)[1] <- "F1"; names(rts2)[2] <- "F2"
rts2$Effect <- rep("Vagueness:Quantity",4)
rts3 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("Vagueness","Order")); names(rts3)[1] <- "F1"; names(rts3)[2] <- "F2"
rts3$Effect <- rep("Vagueness:Order",4)
rts5 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("Selection","Quantity")); names(rts5)[1] <- "F1"; names(rts5)[2] <- "F2"
rts5$Effect <- rep("Selection:Quantity",4)
rts6 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("Selection","Order")); names(rts6)[1] <- "F1"; names(rts6)[2] <- "F2"
rts6$Effect <- rep("Selection:Order",4)
rts8 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("Quantity","Order")); names(rts8)[1] <- "F1"; names(rts8)[2] <- "F2"
rts8$Effect <- rep("Quantity:Order",4)
rts <- rbind(rts1,rts2,rts3,rts5,rts6,rts8)
rts <- subset(rts, select=c(Effect, F1, F2, RT_log, RT_log_norm, sd, se, ci))
rts$mins=rts$RT_log-rts$ci
rts$maxs=rts$RT_log+rts$ci
```

```{r,bar7,fig.width=10, fig.height=3}
# plot 2 way interactions
ggplot(rts, aes(y=RT_log, x=F2, group=F1, ymin=mins, ymax=maxs, pch=F1)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_wrap(~Effect, scale="free_x", nrow=1) + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank()) +
  xlab("Levels")
```

Plot 2 way interactions over items

```{r foo2, message=FALSE}
# prep 2 ways over items rts data frame
rts1 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio", "Vagueness","Selection")); names(rts1)[2] <- "F1"; names(rts1)[3] <- "F2"
rts1$E1 <- "Vagueness"
rts1$E2 <- "Selection"
rts2 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio", "Vagueness","Quantity")); names(rts2)[2] <- "F1"; names(rts2)[3] <- "F2"
rts2$E1 <- "Vagueness"
rts2$E2 <- "Quantity"
rts3 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio", "Vagueness","Order")); names(rts3)[2] <- "F1"; names(rts3)[3] <- "F2"
rts3$E1 <- "Vagueness"
rts3$E2 <- "Order"
rts4 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio", "Quantity", "Selection")); names(rts4)[2] <- "F1"; names(rts4)[3] <- "F2"
rts4$E1 <- "Quantity"
rts4$E2 <- "Selection"
rts5 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio", "Order","Selection")); names(rts5)[2] <- "F1"; names(rts5)[3] <- "F2"
rts5$E1 <- "Order"
rts5$E2 <- "Selection"
rts6 <- summarySEwithin(dd, measurevar="RT_log", withinvars=c("item_mean_ratio", "Quantity","Order")); names(rts6)[2] <- "F1"; names(rts6)[3] <- "F2"
rts6$E1 <- "Quantity"
rts6$E2 <- "Order"

rts <- rbind(rts1,rts2,rts3,rts4,rts5,rts6)
rts$mins=rts$RT_log-rts$ci
rts$maxs=rts$RT_log+rts$ci

rts$item_mean_ratio <- as.numeric(as.character(rts$item_mean_ratio))
rts$F3 <- factor(paste(rts$F1,rts$F2))

rts$E1 <- factor(rts$E1, levels=c("Selection","Order","Quantity","Vagueness"))
rts$E2 <- factor(rts$E2, levels=c("Selection","Order","Quantity","Vagueness"))

# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

ggplot(rts, aes(y=RT_log, x=item_mean_ratio, group=F3, col=F2, pch=F1)) + 
  facet_grid(E2~E1, drop=F) + 
  geom_point(cex=3) + geom_line() + theme_bw() + 
  theme(aspect.ratio=1, panel.grid=element_blank()) +
  scale_color_manual(name="colour",values=cbbPalette) +
  scale_shape_discrete(name="shape") +
  scale_x_continuous(breaks = round(sort(unique(rts$item_mean_ratio)),1))
```

# RT model all items

```{r, foo3, rtmodel-allitems}
# backing off A LOT from maximal model to avoid warning about maxfun
rtm <- lme4::lmer(
  data=dd,
  RT_log ~ 
    c_Vag * Selection.sum + item_mean_ratio + c_Qty + c_Ord + s_Trl +
    RTprev_log  + 
  ( c_Vag * Selection.sum | Subject)
)
rtm.summary <- summary(rtm)
rtm.confint <- confint(rtm, method='Wald')[13:20,]
```

Print a table of coefficients.

```{r, foo4, rtmodeltable, results='asis', echo=FALSE}
print(xtable(
  digits=c(0,2,2,1), 
  rtm.summary$coefficients), type='html')
```

Plot coefficients

```{r, foo5}
par(las=2, mar=c(14,6,1,1))
y=coef(rtm.summary)[-1,1] # omit intercept
n=length(y)
plot(y, xaxt="n", xlab="", ylab="RT_log\n", pch=19, ylim=extendrange(y, f=.20), main="Coefficients")
abline(h=0)
axis(1, labels=names(y) , at=1:n)
grid()
segments(x0=1:n, x1=1:n, y0=rtm.confint[,1], y1=rtm.confint[,2], lwd=2)
```

Plot partial effects

```{r foo6}
par(mfrow=c(2,4))
plotLMER.fnc(rtm)
```

```{r foo7}
suppressPackageStartupMessages(require(languageR))
cat("k is:",
collin.fnc(dd[,c("c_Trl", "Selection.sum", "c_Vag", "c_Qty", "c_Ord", "item_mean_ratio", "RTprev_log")])$cnumber)
```

```{r foo8, fig.width=6, fig.height=5}
suppressPackageStartupMessages(require(rms))
par(mar=c(1.1,3.1,1.1,1.1), pty='s')
plot(varclus(as.matrix(dd[,c("c_Trl", "Selection.sum", "c_Vag", "c_Qty", "c_Ord", "item_mean_ratio", "RTprev_log")])))
```

Model criticism baayen plots

```{r daz, fig.width=9, fig.height=3}
# Baayen 4-plot model criticism

par(mfrow=c(1,4), pty='s')
# create scaled residuals
dd$rstand = as.vector(scale(resid(rtm)))
# plot scaled residuals density
plot(density(dd$rstand))
# plot sample quantiles versus theoretical quantiles
qqnorm(dd$rstand, cex=.5)
qqline(dd$rstand)
# plot standardised residuals versus fitted values
plot(dd$rstand ~ fitted(rtm), pch='.')
# absolute standardised residuals greater than 2.5 are candidates for being outliers, the abline identifies them on the plot
abline(h=c(-2.5,2.5))

```

Refit model with outliers removed (3.5 sd)

```{r daz2}
dd2 <- subset(dd, abs(rstand)<3.5 )
```

```{r daz3}
# backing off A LOT from maximal model to avoid warning about maxfun
rtm <- lmer(
  data=dd2,
  RT_log ~ 
    c_Vag * Selection.sum + item_mean_ratio + c_Qty + c_Ord + s_Trl +
    RTprev_log  + 
  ( c_Vag * Selection.sum | Subject)
)
rtm.summary <- summary(rtm)
rtm.confint <- confint(rtm, method='Wald')
```

Print a table of coefficients.

```{r daz4,  results='asis', echo=FALSE}
print(xtable(
  digits=c(0,2,2,1,1,3), 
  rtm.summary$coefficients), type='html')
```

Plot coefficients

```{r daz5}
par(las=2, mar=c(14,6,1,1))
y=coef(rtm.summary)[-1,1] # omit intercept
n=length(y)
plot(y, xaxt="n", xlab="", ylab="RT_log\n", pch=19, ylim=extendrange(y, f=.20), main="Coefficients")
abline(h=0)
axis(1, labels=names(y) , at=1:n)
grid()
segments(x0=1:n, x1=1:n, y0=rtm.confint[13:20,1], y1=rtm.confint[13:20,2], lwd=2)
```

Plot partial effects

```{r daz6}
par(mfrow=c(2,4))
plotLMER.fnc(rtm)
```

```{r daz7}
suppressPackageStartupMessages(require(languageR))
cat("k is:",
collin.fnc(dd2[,c("c_Trl", "Selection.sum", "c_Vag", "c_Qty", "c_Ord", "item_mean_ratio", "RTprev_log")])$cnumber
)
```

```{r daz9, fig.width=6, fig.height=5}
suppressPackageStartupMessages(require(rms))
par(mar=c(1.1,3.1,1.1,1.1), pty='s')
plot(varclus(as.matrix(dd2[,c("c_Trl", "Selection.sum", "c_Vag", "c_Qty", "c_Ord", "item_mean_ratio", "RTprev_log")])))
```

Model criticism baayen plots

```{r mc1, fig.width=9, fig.height=3}
# Baayen 4-plot model criticism

par(mfrow=c(1,4), pty='s')
# create scaled residuals
dd2$rstand = as.vector(scale(resid(rtm)))
# plot scaled residuals density
plot(density(dd2$rstand))
# plot sample quantiles versus theoretical quantiles
qqnorm(dd2$rstand, cex=.5)
qqline(dd2$rstand)
# plot standardised residuals versus fitted values
plot(dd2$rstand ~ fitted(rtm), pch='.')
# absolute standardised residuals greater than 2.5 are candidates for being outliers, the abline identifies them on the plot
abline(h=c(-2.5,2.5))

```

Separate analyses for vague vs crisp at each level of selection (matching, and comparison)

not done yet.

```{r sep1,  results='asis', echo=FALSE}
print(xtable(
  digits=c(0,2,2,1,1,3), 
  rtm.summary$coefficients), type='html')
```

# Borderline analysis

not done yet.
