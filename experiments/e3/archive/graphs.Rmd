Vagueness experiment 4 graphs
========================================================

```{r loaddata, echo=FALSE}
rm(list=ls())
load("e4vagueness.RData")
levels(x$vagueness)<-c("Crisp","Vague")
levels(x$selection)<-c("Comparison","Matching")
levels(x$Item)<-c("6:15:24","16:25:34","26:35:44","36:45:54")
source("CIfunctions.R")
```

RT cutoffs: subset=RT>0&RT<49000

```{r loadlibraries, echo=FALSE}
require(ggplot2, quietly=TRUE)
require(reshape2, quietly=TRUE)
require(lattice, quietly=TRUE)
require(gridExtra, quietly=TRUE)
library(plyr)
```

Show distribution of response times.

```{r rtdist1 ,echo=FALSE}
# Untransformed
untransformed = ggplot(x, aes(x=RT)) + 
  geom_histogram(aes(y=..density..),
                 binwidth=500,
                 colour="black", fill="white") +
  geom_density(alpha=.2, fill="blue")
```

```{r logrtdist, echo=FALSE }
# Log transformed
logtransformed = ggplot(x, aes(x=logRT)) + 
  geom_histogram(aes(y=..density..),
                 binwidth=.1,
                 colour="black", fill="white") +
  geom_density(alpha=.2, fill="blue")
```

```{r showtransform, echo=FALSE, fig.width=7, fig.height=3, warning=FALSE}
grid.arrange(untransformed,logtransformed, ncol=2)
```

Show distribution separately for each group.

First way.

```{r density1,echo=FALSE}
# Density plot per group overlaid with means
cdf <- ddply(x, .(Effect), summarise, logRT.mean=mean(logRT))
distributionbygroup = ggplot(x, aes(x=logRT, colour=Effect)) + geom_density() + theme_bw() 

distributionbygroupAddMeans = distributionbygroup  + geom_vline(data=cdf, aes(xintercept=logRT.mean, colour=Effect), linetype="dashed", size=.5)  
```

```{r density2,echo=FALSE, fig.width=7, fig.height=3}
print(distributionbygroup)
```

```{r densityfaceted,echo=FALSE}
# Density plot per group faceted
distributionbygroupv2 = ggplot(x, aes(x=logRT)) + 
  geom_histogram(binwidth=.1, colour="black", fill="white")  +
  geom_vline(data=cdf, aes(xintercept=logRT.mean),
             linetype="dashed", size=1, colour="red") +
facet_grid(Effect~.) 
```

Second way

```{r showway2dist,echo=FALSE,fig.width=5,fig.height=5,warning=FALSE}
print(distributionbygroupv2)
```

Boxplot with mean indicator.

```{r boxplot1, fig.width=3,fig.height=3, echo=FALSE}
# Boxplot with mean indicator
boxplotmeanind = ggplot(x, aes(x=vagueness, y=logRT)) + geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", shape=5, size=4) +
  facet_wrap(~selection)
print(boxplotmeanind)
```

```{r, conditionmeans, echo=FALSE}
# condition means - main effect of selection
meanRT <- tapply(x$RT,x$selection,mean)
selection <- factor(rep(levels(x$selection),each=1))
rt1=ggplot(data.frame(selection,meanRT), aes(y=meanRT,x=selection)) +
  geom_bar(position="dodge",stat="identity") + scale_fill_grey()+theme_bw()+
  coord_cartesian(ylim = c(0, 3200))
```

```{r moreconditionmeans,echo=FALSE}
# condition means - main effect of vagueness
meanRT <- tapply(x$RT,x$vagueness,mean)
vagueness <- factor(rep(levels(x$vagueness),each=1))
rt2=ggplot(data.frame(vagueness,meanRT), aes(y=meanRT,x=vagueness)) +
  geom_bar(position="dodge",stat="identity") + scale_fill_grey()+theme_bw()+
  coord_cartesian(ylim = c(0, 3200))
```

Show the main effects of vagueness and selection separately.

```{r showmaineffects, echo=FALSE, fig.width=7, fig.height=3}
grid.arrange(rt1,rt2,ncol=2)
```



```{r showmaineffects2, echo=FALSE}
# condition means but with ggplot2
# This was the code for precogsci2013 bar plot of RT by condition
meanRT <- tapply(x$RT,x$selection:x$vagueness,mean)
vagueness <- factor(rep(levels(x$vagueness),2))
selection <- factor(rep(levels(x$selection),each=2))
rt3=ggplot(data.frame(vagueness,selection,meanRT), 
           aes(y=meanRT,x=selection,fill=vagueness)) +
  geom_bar(position="dodge",stat="identity") + 
  scale_fill_grey() + 
  theme_bw() + coord_cartesian(ylim = c(0, 3200)) +
  geom_segment(aes(x = .75, y = 2000, xend = .75, yend = 2050))+
  geom_segment(aes(x =.75, y=2050, xend=1.25,yend=2050))+
  geom_segment(aes(x =1.25, y=2050, xend=1.25,yend=2000))+
  annotate("text",x=1, y=2100, label="*", size=7)+
  geom_segment(aes(x = 1.75, y = 2600, xend = 1.75, yend = 2650))+
  geom_segment(aes(x = 1.75, y = 2650, xend = 2.25, yend = 2650))+
  geom_segment(aes(x = 2.25, y = 2650, xend = 2.25, yend = 2600))+
  annotate("text",x=2, y=2720, label="NS", size=3)+
  geom_segment(aes(x=1,y=2200,xend=1,yend=3000))+
  geom_segment(aes(x=1,y=3000,xend=2,yend=3000))+
  geom_segment(aes(x=1,y=3000,xend=2,yend=3000))+
  geom_segment(aes(x=2,y=3000,xend=2,yend=2800))+
  annotate("text",x=1.5,y=3050, label="***", size=7)
#+
#              ggtitle(label="Response Time")
```



```{r showmaineffects3,echo=FALSE}
# condition means the other way
rt4=ggplot(data.frame(vagueness,selection,meanRT), aes(y=meanRT,x=vagueness,fill=selection)) + 
  geom_bar(position="dodge",stat="identity") + scale_fill_grey()+theme_bw()+coord_cartesian(ylim = c(0, 3200))+ 
  geom_segment(aes(x=1,y=2600,xend=1,yend=3000))+
  geom_segment(aes(x=1,y=3000,xend=2,yend=3000))+
  geom_segment(aes(x=1,y=3000,xend=2,yend=3000))+
  geom_segment(aes(x=2,y=3000,xend=2,yend=2600))+
  annotate("text",x=1.5,y=3050, label="NS", size=3)
```

Show the Selection x Vagueness interaction.

```{r selxvag, fig.width=8, fig.height=3, echo=FALSE}
grid.arrange(rt3,rt4,ncol=2)
```

```{r PEXmake, echo=FALSE}
# Probability of choosing an extreme response
pEX <- tapply(x$EXTREME,x$selection:x$vagueness,mean)
vagueness <- factor(rep(levels(x$vagueness),2))
selection <- factor(rep(levels(x$selection),each=2))

pex1 = 
  ggplot(data.frame(vagueness,selection,pEX), 
                       aes(y=pEX,x=selection,fill=vagueness)) + 
  geom_bar(position="dodge",stat="identity") + 
  scale_fill_grey() + 
  theme_bw() +
  scale_y_continuous(breaks=c(0,.25,.5,.75,1),
                     limits=c(0,1.23))+
#  ggtitle(label="Probability of choosing the extreme answer") +
  geom_segment(aes(x = .75, y = .9, xend = .75, yend = 1)) + # left upstroke
  geom_segment(aes(x = .75, y = 1,  xend = 1.25, yend = 1)) + # left across
  geom_segment(aes(x =1.25, y=1, xend=1.25,yend=.95)) + # left downstroke
  annotate("text",x=1, y=1.01, label="*", size=7) + # left annotation
  geom_segment(aes(x = 1.75, y = .8, xend = 1.75, yend = .9))+ # right
  geom_segment(aes(x = 1.75, y = .9, xend = 2.25, yend = .9))+
  geom_segment(aes(x = 2.25, y = .9, xend = 2.25, yend = .6))+
  annotate("text",x=2, y=.92, label="*", size=7) +
  geom_segment(aes(x=1,y=1.1,xend=1,yend=1.15)) + # middle
  geom_segment(aes(x=1,y=1.15,xend=2,yend=1.15)) +
  geom_segment(aes(x=1,y=1.15,xend=2,yend=1.15)) +
  geom_segment(aes(x=2,y=1.15,xend=2,yend=1)) +
  annotate("text",x=1.5,y=1.2, label="***", size=7)

pex1.inverted = ggplot(data.frame(vagueness,selection,pEX), 
              aes(y=1-pEX,x=selection,fill=vagueness)) + 
  geom_bar(position="dodge",stat="identity") + 
  scale_fill_grey() + 
  theme_bw() +
  scale_y_continuous(breaks=c(0,.25,.5,.75,1))+
#   coord_cartesian(ylim = c(0, 1.3)) + 
#  ggtitle(label="1 - Probability of choosing the extreme answer") +
  geom_segment(aes(x = .75, y = .2, xend = .75, yend = .3))+
  geom_segment(aes(x =.75, y=.3, xend=1.25,yend=.3))+
  geom_segment(aes(x =1.25, y=.3, xend=1.25,yend=.15))+
  annotate("text",x=1, y=.33, label="*", size=7) +
  geom_segment(aes(x = 1.75, y = .4, xend = 1.75, yend = .6))+
  geom_segment(aes(x = 1.75, y = .6, xend = 2.25, yend = .6))+
  geom_segment(aes(x = 2.25, y = .6, xend = 2.25, yend = .55))+
  annotate("text",x=2, y=.65, label="*", size=7) +
  geom_segment(aes(x=1,y=.4,xend=1,yend=.8))+
  geom_segment(aes(x=1,y=.8,xend=2,yend=.8))+
  geom_segment(aes(x=1,y=.8,xend=2,yend=.8))+
  geom_segment(aes(x=2,y=.8,xend=2,yend=.7))+
  annotate("text",x=1.5,y=.85, label="***", size=7)
```

Probability of an extreme response.

```{r pexshow, fig.width=8,fig.height=3, echo=FALSE}
grid.arrange(pex1,pex1.inverted, ncol=2)
```


Plots for poster preCogSci 2013

```{r makePlotData}
poda=summarySEwithin(x,measurevar="RT",withinvars=c("vagueness","selection", "Item"), idvar="Subject")
poda$mygroup <- paste(poda$selection,poda$vagueness)
```


```{r makeCogSciPlot}
cogsci=
  ggplot(data=poda,
       aes(y=RT,ymin=RT-ci,ymax=RT+ci,x=Item,group=mygroup,col=mygroup,shape=mygroup,fill=mygroup)) +
  geom_errorbar(position=position_dodge(width=.2), width=.2) +
  geom_line(position=position_dodge(width=.2)) +
  geom_point(position=position_dodge(width=.2), size=4) +
  xlab("Dots")+
  ylab("Reaction time (ms)")+
  scale_colour_manual(values=c("red","blue","red","blue")) +
  scale_shape_manual(values=c(21,21,23,23))+
  scale_fill_manual(values=c("red","blue","white","white")) +
  ggtitle(label="Forced choice task") +
  theme(legend.key = element_blank(),
        legend.title = element_blank(), 
        legend.text = element_text(face="bold", size=12),
        legend.key.size = unit(c(1.5,1.5), "lines"),
        axis.title.x = element_text(face="bold", size=12, vjust=-1.5),
        axis.title.y = element_text(face="bold", size=12, angle=90, vjust=-0.01),
        plot.title = element_text(face="bold", size=14, vjust=1.5),
        plot.margin = unit(c(2, -9.0, 2, 2), "lines"),
        panel.background = element_rect(fill='white', colour='black'))
```

Show cogsci plot
```{r ShowCogSciPlot, fig.width=7,fig.height=5}
print(cogsci)
```


```{r savePlot}
pdf(file="figure/precogsci2013e4.pdf",width=7, height=5)
print(cogsci)
dev.off()
```

```{bwhitevxs}
b <- summarySEwithin(x,measurevar="RT",withinvars=c("vagueness","selection"), idvar="Subject")
b$mygroup=paste(b$selection, b$vagueness)
pd=position_dodge(0.1)
ggplot(data=b,aes(y=RT,x=vagueness,group=selection,col=mygroup,shape=mygroup,fill=mygroup,ymax=RT+ci,ymin=RT-ci))+geom_errorbar(position=pd, width=.1)+geom_line(position=pd)+geom_point(position=pd,size=4)+  scale_colour_manual(values = c("black","black", "black", "black")) +   scale_shape_manual(values = c(21, 23, 21, 23)) +    scale_fill_manual(values = c("black", "black", "white","white"))
```

