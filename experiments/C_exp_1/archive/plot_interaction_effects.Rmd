---
title: "Experiment 2 of 4: interaction_effects"
output:
  html_document:
    template: default
    code_folding: hide
    theme: default
---

```{r, message=FALSE, results='hide', echo=FALSE}
load("dd.Rda")
source('functions/CIfunctions.R')
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(plyr))
if(require(reshape2)){}
```

Main effects

Plot main effects on several transformations

```{r, fig.width=16, fig.height=6, warning=FALSE}
# plot main effects on observed data

# allow reference to transformation
temp <- melt(dd,
             id.vars=c("Item", "Vagueness", "Number", "Quantity", "Order"),
             measure.vars=c("RT_Rec", "RT_RecSqt", "RT_log",  "RT_raw"),
             variable.name="transformation",
             value.name="score")

# allow reference to effect
temp2 <- melt(temp, 
              id.vars=c("transformation", "score"),
              measure.vars=c("Item", "Vagueness", "Number", "Quantity", "Order"),
              variable.name="effect",
              value.name="level")


# do the plot
ggplot(temp2, aes(y=score, x=level, group=1, col=effect)) +
  facet_wrap(~transformation + effect, scales="free", shrink=TRUE, ncol=5) +
  stat_summary(fun.data=mean_cl_normal, geom="pointrange") +
  stat_summary(fun.y=mean, geom="line") +
  theme(aspect.ratio=1, axis.text.y=element_blank())
```

Main effects

```{r}
# prep main effects rts data frame
vrts <- cbind(Effect="Vagueness",x=factor(c(1,2)),summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Vagueness")));names(vrts)[3]<-"Levels"
nrts <- cbind(Effect="Number",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number")));names(nrts)[3]<-"Levels"
qrts <- cbind(Effect="Quantity",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Quantity")));names(qrts)[3]<-"Levels"
orts <- cbind(Effect="Order",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Order")));names(orts)[3]<-"Levels"
irts <- cbind(Effect="Item",x=factor(c(1,2,3,4)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Item")));names(irts)[3]<-"Levels"
rts=rbind(vrts,nrts,qrts,orts)
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci
```

```{r, fig.width=9, fig.height=3}
# plot main effects
ggplot(rts, aes(y=RT_RecSqt, x=Levels, group=1, ymin=mins, ymax=maxs)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Effect, scale="free_x") + 
  theme_bw() +
  theme(aspect.ratio=1) 
```

Main effects over items

```{r, message=FALSE, fig.width=10, fig.height=3}
vrts <- cbind(Effect="Vagueness",x=factor(c(1,2)),summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio","Vagueness")));names(vrts)[4]<-"Levels"
nrts <- cbind(Effect="Number",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio","Number")));names(nrts)[4]<-"Levels"
qrts <- cbind(Effect="Quantity",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio","Quantity")));names(qrts)[4]<-"Levels"
orts <- cbind(Effect="Order",x=factor(c(1,2)), summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio","Order")));names(orts)[4]<-"Levels"

rts=rbind(vrts,nrts,qrts,orts)
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci

rts$item_mean_ratio <- as.numeric(as.character(rts$item_mean_ratio))

ggplot(rts, aes(y=RT_RecSqt, x=item_mean_ratio, group=Levels, ymin=mins, ymax=maxs, shape=Levels, fill=Levels, col=Levels)) +
  scale_shape_manual(values=c(21,21,22,22,23,23,24,24)) +
  scale_fill_manual(values=c("black","gray","black","gray","black","gray","black","gray")) +
  scale_color_manual(values=c("black","gray","black","gray","black","gray","black","gray")) +
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Effect) + 
  theme_bw() +
  theme(aspect.ratio=1, 
        panel.grid=element_blank()) +
  scale_x_continuous(breaks = round(sort(unique(rts$item_mean_ratio)),1)) 

```


2 way interactions not involving items.

```{r}
# prep 2 ways rts data frame
rts1 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Vagueness","Number")); names(rts1)[1] <- "F1"; names(rts1)[2] <- "F2"
rts1$Effect <- rep("Vagueness:Number",4)
rts2 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Vagueness","Quantity")); names(rts2)[1] <- "F1"; names(rts2)[2] <- "F2"
rts2$Effect <- rep("Vagueness:Quantity",4)
rts3 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Vagueness","Order")); names(rts3)[1] <- "F1"; names(rts3)[2] <- "F2"
rts3$Effect <- rep("Vagueness:Order",4)
rts5 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Quantity")); names(rts5)[1] <- "F1"; names(rts5)[2] <- "F2"
rts5$Effect <- rep("Number:Quantity",4)
rts6 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Order")); names(rts6)[1] <- "F1"; names(rts6)[2] <- "F2"
rts6$Effect <- rep("Number:Order",4)
rts8 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Quantity","Order")); names(rts8)[1] <- "F1"; names(rts8)[2] <- "F2"
rts8$Effect <- rep("Quantity:Order",4)
rts <- rbind(rts1,rts2,rts3,rts5,rts6,rts8)
rts <- subset(rts, select=c(Effect, F1, F2, RT_RecSqt, RT_RecSqt_norm, sd, se, ci))
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci
```

```{r,fig.width=10, fig.height=3}
# plot 2 way interactions
ggplot(rts, aes(y=RT_RecSqt, x=F2, group=F1, ymin=mins, ymax=maxs, pch=F1)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_wrap(~Effect, scale="free_x", nrow=1) + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank()) +
  xlab("Levels")
```

Plot 2 way interactions over items

```{r, message=FALSE}
# prep 2 ways over items rts data frame
rts1 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio", "Vagueness","Number")); names(rts1)[2] <- "F1"; names(rts1)[3] <- "F2"
rts1$E1 <- "Vagueness"
rts1$E2 <- "Number"
rts2 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio", "Vagueness","Quantity")); names(rts2)[2] <- "F1"; names(rts2)[3] <- "F2"
rts2$E1 <- "Vagueness"
rts2$E2 <- "Quantity"
rts3 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio", "Vagueness","Order")); names(rts3)[2] <- "F1"; names(rts3)[3] <- "F2"
rts3$E1 <- "Vagueness"
rts3$E2 <- "Order"
rts4 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio", "Quantity", "Number")); names(rts4)[2] <- "F1"; names(rts4)[3] <- "F2"
rts4$E1 <- "Quantity"
rts4$E2 <- "Number"
rts5 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio", "Order","Number")); names(rts5)[2] <- "F1"; names(rts5)[3] <- "F2"
rts5$E1 <- "Order"
rts5$E2 <- "Number"
rts6 <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("item_mean_ratio", "Quantity","Order")); names(rts6)[2] <- "F1"; names(rts6)[3] <- "F2"
rts6$E1 <- "Quantity"
rts6$E2 <- "Order"



rts <- rbind(rts1,rts2,rts3,rts4,rts5,rts6)
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci

rts$item_mean_ratio <- as.numeric(as.character(rts$item_mean_ratio))
rts$F3 <- factor(paste(rts$F1,rts$F2))

rts$E1 <- factor(rts$E1, levels=c("Number","Order","Quantity","Vagueness"))
rts$E2 <- factor(rts$E2, levels=c("Number","Order","Quantity","Vagueness"))

# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")


ggplot(rts, aes(y=RT_RecSqt, x=item_mean_ratio, group=F3, col=F2, pch=F1)) + 
  facet_grid(E2~E1, drop=F) + 
  geom_point(cex=3) + geom_line() + theme_bw() + 
  theme(aspect.ratio=1, panel.grid=element_blank()) +
  scale_color_manual(name="colour",values=cbbPalette) +
  scale_shape_discrete(name="shape") +
  scale_x_continuous(breaks = round(sort(unique(rts$item_mean_ratio)),1))

```

Plot vagueness by number interaction over items

```{r, fig.width=7, fig.height=3.5, eval=TRUE, cache=FALSE}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Vagueness","Item"))
rts$condition=paste(rts$Number,rts$Vagueness, sep= ' ')
dodge = position_dodge(width=0.2)
ggplot(rts, aes(y=RT_RecSqt, x=Item, ymin=RT_RecSqt-ci, ymax=RT_RecSqt+ci, 
                group=condition, shape=condition, fill=condition)) +
  geom_line(position=dodge) + 
  geom_errorbar(width=.2, position=dodge) + 
  geom_point(size=4, position=dodge) + 
  scale_shape_manual("",values = c(22, 22, 21, 21)) + 
  scale_fill_manual("",values=c("black","white","black","white")) +
  ggtitle("Response time") + 
  ylab("RT_RecSqt") + 
  xlab("") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.key = element_blank(), aspect.ratio=1, axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~Number)
```

3 way interactions 

```{r}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Vagueness","Quantity"))
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci
p1=ggplot(rts, aes(y=RT_RecSqt, x=Number, group=Vagueness, ymin=mins, ymax=maxs, pch=Vagueness)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Quantity, scale="free_x") + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank(), legend.position="top")
```


```{r}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Vagueness","Order"))
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci
p2=ggplot(rts, aes(y=RT_RecSqt, x=Number, group=Vagueness, ymin=mins, ymax=maxs, pch=Vagueness)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Order, scale="free_x") + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank(), legend.position="top")
```

```{r}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Quantity","Order"))
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci
p3=ggplot(rts, aes(y=RT_RecSqt, x=Number, group=Quantity, ymin=mins, ymax=maxs, pch=Quantity)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Order, scale="free_x") + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank(), legend.position="top")
```


```{r}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Vagueness","Quantity","Order"))
rts$mins=rts$RT_RecSqt-rts$ci
rts$maxs=rts$RT_RecSqt+rts$ci
p4=ggplot(rts, aes(y=RT_RecSqt, x=Vagueness, group=Quantity, ymin=mins, ymax=maxs, pch=Quantity)) + 
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  facet_grid(~Order, scale="free_x") + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank(), legend.position="top")
```

```{r, fig.width=10,fig.height=5}
grid.arrange(nrow=2, p1,p2,p3,p4)
```

Plot vagueness by number by quantity over items.

```{r, fig.width=10, fig.height=4, eval=TRUE}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number","Vagueness","Item", "Quantity"))
rts$condition=paste(rts$Number,rts$Vagueness, sep= ' ')
dodge = position_dodge(width=0.2)
ggplot(rts, aes(y=RT_RecSqt, x=Item, ymin=RT_RecSqt-ci, ymax=RT_RecSqt+ci, 
                group=Vagueness, 
                fill=Vagueness)) +
  geom_line(position=dodge) + 
  geom_errorbar(width=.2, position=dodge) + 
  geom_point(pch=21, size=4, position=dodge) + 
  scale_fill_manual("",values=c("black","white")) +
  ggtitle("Response time") + 
  ylab("RT_Rec_Sqt") + 
  xlab("") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background=element_rect(fill="white",color=1),
        legend.key = element_blank(), 
        aspect.ratio=1, axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~Number+Quantity)
```


4 way interaction

```{r}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number", "Vagueness",  "Quantity", "Order"))
rts$condition=paste(rts$Number,rts$Vagueness, sep= ' ')
ggplot(rts, aes(y=RT_RecSqt, x=Vagueness, ymin=RT_RecSqt-ci, ymax=RT_RecSqt+ci, group=Quantity, pch=Quantity)) +
  facet_grid(~Order+Number, scale="free_x") +
  geom_line() +
  geom_errorbar(width=.1) +
  geom_point(cex=3) + 
  theme_bw() +
  theme(aspect.ratio=1) +
  theme(legend.title=element_blank())
```


4 way interaction split over items


```{r, fig.width=8, fig.height=8, eval=TRUE, cache=FALSE, echo=TRUE}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number", "Vagueness", "Item", "Quantity", "Order"))
rts$condition=paste(rts$Number,rts$Vagueness, sep= ' ')
dodge = position_dodge(width=0.2)
ggplot(rts, aes(y=RT_RecSqt, x=Item, ymin=RT_RecSqt-ci, ymax=RT_RecSqt+ci, 
                group=Vagueness,fill=Vagueness)) +
  geom_line(position=dodge) + 
  geom_errorbar(width=.2, position=dodge) + 
  geom_point(pch=21, size=4, position=dodge) + 
  scale_fill_manual("",values=c("black","white","black","white")) +
  ggtitle("Number * Vagueness * Quantity * Order") + 
  ylab("RT_RecSqt") + 
  xlab("") +
  theme_bw() +
  theme( legend.key = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1), axis.text.x = element_text(angle = 45, hjust = 1), aspect.ratio=1) +
  facet_grid(Vagueness+Order~Number+Quantity)
```

4 way interaction split over items showing ratio of item dots.

```{r, fig.width=8, fig.height=8, eval=TRUE, cache=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
rts <- summarySEwithin(dd, measurevar="RT_RecSqt", withinvars=c("Number", "Vagueness", "item_mean_ratio", "Quantity", "Order"))
rts$condition=paste(rts$Number,rts$Vagueness, sep= ' ')
rts$item_mean_ratio <- as.numeric(as.character(rts$item_mean_ratio))
dodge = position_dodge(width=0.2)
ggplot(rts, aes(y=RT_RecSqt, x=item_mean_ratio, ymin=RT_RecSqt-ci, ymax=RT_RecSqt+ci, 
                group=Vagueness,fill=Vagueness)) +
  geom_line(position=dodge) + 
  geom_errorbar(width=.2, position=dodge) + 
  geom_point(pch=21, size=4, position=dodge) + 
  scale_fill_manual("",values=c("black","white","black","white")) +
  ggtitle("Number * Vagueness * Quantity * Order") + 
  ylab("RT_RecSqt") + 
  xlab("") +
  theme_bw() +
  theme( legend.key = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1), axis.text.x = element_text(angle = 45, hjust = 1), aspect.ratio=1) +
  facet_grid(Vagueness+Order~Number+Quantity)
```

