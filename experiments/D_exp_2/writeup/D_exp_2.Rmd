---
title: "D_exp_2"
author: "Matt Green"
output:
  html_document:
    toc: true
    toc_float: false
---  

```{r, echo=FALSE, message=FALSE}
library(knitr)
library(tidyverse)
library(broom)
library(broom.mixed)
library(lme4)
library(lmerTest)
library(dotwhisker)
library(kableExtra)
library(LMERConvenienceFunctions)
library(data.table)
library(gridExtra)
source("D_exp_2_functions/preprocessing.R")
source("D_exp_2_functions/pretty_coef_table.R")
source("D_exp_2_functions/summarySEwithin2.R")
root_dir <- getwd()
data_dir <- "D_exp_2_data"
```

```{r}
dat <- preprocessing(root_dir, data_dir)
dat <- perSubjectTrim.fnc(dat, response='RT', subject='Subject', trim = 2.5)$data
dat$RT_log <- log(dat$RT)
```

# Info and Procedure (Method)

Experiment Structure: 
Each subject saw 192 trials, being 3 cycles of 64 trials. There were 38 participants. There were 7296 rows in the full data set.

Trial Procedure: 
First an instruction that was a referring expression was presented until participants dismissed it with a key press. Then the squares with dots were presented until the participant responded with a key press, with a 60 second timeout if they did not respond.

# Sample display

Remember to do a screenshot for the sample display.

# Full table of instructions

```{r, echo=FALSE}
instructions_table <- 
  dat %>%
    select(Item, Quantity, Vagueness, Selection, Instruction) %>%
    unique() %>%
    arrange(Item, Quantity, Vagueness, Selection) %>%
    spread(key=Vagueness, value=Instruction)
# kable(instructions_table, format="latex", booktabs = TRUE)
instructions_table %>% 
  kable(align='cccll', caption="Full table of instructions") %>% 
      kable_styling(full_width = F, position = "left", font_size = 11) 
```

# Means plots

```{r trimat25sd}
dat_plot <- summarySEwithin2(dat, measurevar="RT_log", withinvars=c("Vagueness", "Selection", "Item"), idvar="Subject")
```

```{r rtplot1, fig.width=7, fig.height=3}
dodge = position_dodge(width=0.2)
dat_plot$Condition <- as.factor(paste(sep=' ', dat_plot$Selection, dat_plot$Vagueness))
rtplot=ggplot(dat_plot,
              aes(y=RT_logNormed, x=Item, ymin=RT_logNormed-ci, ymax=RT_logNormed+ci,
                group=Condition, shape=Condition, fill=Condition)) +
  geom_line(position=dodge) +
  geom_errorbar(width=.2, position=dodge) +
  geom_point(size=2, position=dodge) +
  scale_shape_manual("",values = c(22, 22, 21, 21)) +
  scale_fill_manual("",values=c("black","white","black","white")) +
  ggtitle("Response time") +
  ylab("Respone time (log (ms))") + 
  xlab("") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        legend.key = element_blank(), aspect.ratio=1,
        axis.text.x = element_text(angle = 45, hjust = 1),
        plot.background=element_rect(fill=NA, color='white')) +
  facet_grid(~Selection) 
rtplot
```

```{r}
dat_borderline <- dat
```

```{r, "Borderline response distribution plot", fig.width=7, fig.height=3.5, echo=FALSE, results='hide'}
dat_borderline$response_cat <- factor(dat_borderline$response_cat, levels= c("Near", "Expected", "Far"))

ggplot(dat_borderline) + 
  geom_bar(aes(response_cat, group=Selection:Vagueness, fill=Vagueness), position=position_dodge(width=NULL)) +   
  scale_fill_grey() + 
  xlab(NULL) + 
  ggtitle('Borderline response distribution') + 
  facet_grid(~Selection) +
  theme_bw() + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.key = element_blank(), legend.position="top", aspect.ratio=1, plot.background = element_rect(fill=NA, color='white'), strip.background=element_blank(), legend.key.size=unit(4, 'mm'), axis.text.x = element_text(angle = 15))

```

# Hypotheses

# Results

```{r rtlmer, cache=TRUE, results='asis'}
dat_model <- dat
dat_model$c_Vag <- ifelse(dat_model$Vagueness=="Crisp", -0.5, 0.5)
dat_model$c_Sel <- ifelse(dat_model$Selection=="Comparison", -0.5, 0.5)
dat_model$c_Itm <- ifelse(dat_model$Item=="06:15:24", -.75, ifelse(dat_model$Item=="16:25:34", -.25, ifelse(dat_model$Item=="26:35:44", .25, .75)))
rtlmer = lmerTest::lmer(data=dat_model,
                        RT_log ~ c_Vag * c_Sel + c_Itm +
                          (1 + c_Vag * c_Sel + c_Itm | Subject))
pretty_coef_table(rtlmer, "rtlmer")
```

```{r seplmersforcomparison, results='asis', cache=TRUE, echo=-5}
dat_model <- subset(dat, subset=Selection=='Comparison')
dat_model$c_Vag <- ifelse(dat_model$Vagueness=="Crisp", -0.5, 0.5)
dat_model$c_Itm <- ifelse(dat_model$Item=="06:15:24", -.75, ifelse(dat_model$Item=="16:25:34", -.25, ifelse(dat_model$Item=="26:35:44", .25, .75)))
s1lm <- lmerTest::lmer(data=dat_model, RT_log ~ c_Vag + c_Itm + (1 + c_Vag + c_Itm | Subject))
pretty_coef_table(s1lm, "s1lm")
```

```{r seplmersformatching, results='asis', cache=TRUE, echo=-5}
dat_model <- subset(dat, subset=Selection=='Matching')
dat_model$c_Vag <- ifelse(dat_model$Vagueness=="Crisp", -0.5, 0.5)
dat_model$c_Itm <- ifelse(dat_model$Item=="06:15:24", -.75, ifelse(dat_model$Item=="16:25:34", -.25, ifelse(dat_model$Item=="26:35:44", .25, .75)))
s2lm <- lmerTest::lmer(data=dat_model, RT_log ~ c_Vag + c_Itm + (1 + c_Vag + c_Itm | Subject))
pretty_coef_table(s2lm, "s2lm")
```

# Discussion




