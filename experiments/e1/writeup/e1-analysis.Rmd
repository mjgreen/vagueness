---
title: "Experiment 1 of 4"
output:
  html_document:
    toc: yes
    mathjax: default
    template: default
    theme: default
---

<style>
table, th, td {
    border: 1px grey;
    border-collapse: collapse;
    padding:2px 5px 2px 5px
}  
</style>

```{r pander, echo=FALSE, cache=FALSE}
library(pander)
library(knitr)
```

```{r showInstructions, echo=FALSE, cache=TRUE}
v = c("crisp","vague")
e <- c("Choose the the square with many dots", "Choose the square with 20 dots")
i = data.frame(v, e)
names(i) = c("vagueness", "example instruction")
pander(i, justify=c('center', 'left'))
```

```{r showItems, echo=FALSE, cache=TRUE}
items = c(1,2,3,4,5,6,7,8)
i = data.frame(Gap = c("05","10","15","20"),
               x = c("25:20","25:15","25:10","25:05"),
               z = c("25:30","25:35","25:40","25:45") )
names(i) = c('Gap Size', 'Small Target', 'Large Target')
pander(i, justify=c('center', 'center', 'center'))
```

```{r loadLibraries, message=FALSE, echo=FALSE, cache=FALSE}
library(knitr); library(ggplot2); library(xtable); library(gridExtra); library(lme4); library(lmerTest);  library(data.table); library(dplyr); library(dtplyr); library(pander); library(LMERConvenienceFunctions); source('summarySEwithin2.R') 
```

In this experiment it was possible to identify errors.
This is because there were only 2 squares and an instruction uniquely identified one of them.
Therefore error trials were removed from analysis of response times:

```{r separateDataFramesForRTandErrorAnalyses, echo=TRUE, cache=FALSE}
rawdata <- read.delim('e1-data.txt')
rtdata <- subset(rawdata, error==FALSE)
erdata <- rawdata
```

Correct responses were trimmed at 2.5 sd separately for each subject:

```{r trimData, echo=TRUE, cache=FALSE}
tempdata <- perSubjectTrim.fnc(rtdata, response='rt', subject='subject', trim = 2.5)$data
rtdata <- tempdata
```

```{r, e1RTandErrorRatesplot, fig.width=7, fig.height=3, echo=FALSE, message=FALSE, dev='pdf'}
rtdataplot1 = summarySEwithin2(rtdata,  measurevar="logrt",  withinvars=c("Vgn","Gap"), idvar="subject")
erdataplot1 <- summarySEwithin2(erdata, measurevar="error", withinvars=c("Vgn","Gap"), idvar="subject")
rtdataplot1$metric = 'Response time (log ms)'
erdataplot1$metric = 'Error rate (proportion)'
rtdataplot1$score=rtdataplot1$logrt;rtdataplot1$logrt=NULL
erdataplot1$score=erdataplot1$error;erdataplot1$error=NULL
rtdataplot1$normed=rtdataplot1$logrtNormed;rtdataplot1$logrtNormed=NULL
erdataplot1$normed=erdataplot1$errorNormed;erdataplot1$errorNormed=NULL
combined=rbind(rtdataplot1,erdataplot1)
combined$metric=as.factor(combined$metric)
combined$metric=relevel(combined$metric, ref='Response time (log ms)')
combinedplote1 = ggplot(data=combined, aes(y=normed, x=Gap, group=Vgn, fill=Vgn)) +
  xlab("Numerical distance") + ylab(NULL) +
  geom_line() +
  geom_errorbar(width=.1, lty=1, col=1, aes(ymin=normed-ci, ymax=normed+ci)) +
  geom_point(size=3, col=1, aes(shape=Vgn)) +
  facet_wrap(~metric, scales="free_y") +
  scale_fill_grey(name="Vagueness", start=0, end=1) +
  scale_shape_manual(name="Vagueness", values=c(21,22)) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        legend.key = element_blank(),
        strip.text.x = element_text(size = 12),
        strip.background=element_blank(),
        aspect.ratio=1)
combinedplote1
```

This code computes the models:

```{r showVersions, echo=FALSE, comment=NA}
cat (paste(sep="", 
           c("lmerTest version "), c(packageDescription("lmerTest", fields = "Version")),
           "; ", 
           c("lme4 version "), c(packageDescription("lme4", fields = "Version"))) ) 
```

```{r computeLmerModels, cache = TRUE, tidy=FALSE}
rt.lmer.1 <- lmerTest::lmer(
  data=rtdata, logrt ~ c_Vgn * c_Gap + (c_Vgn * c_Gap|subject))

ac.lmer.1 <- lme4::glmer(
  data = erdata, error ~ c_Vgn * c_Gap + (c_Vgn * c_Gap | subject), 
  family="binomial", control = glmerControl(optimizer = "bobyqa"))
```

```{r tableRTmodelSimple, results='asis', echo=FALSE, cache=F}
print(
  xtable(
    summary(rt.lmer.1)$coefficients[,-3], 
    display=c("s","f","f","f","f"),
    digits=c(0,2,2,1,3),
    caption="Response time model"),
  caption.placement="top", 
  type='html')
```

```{r tableErrorModelsimple, results='asis', echo=FALSE, cache=F}
print(
  xtable(
    summary(ac.lmer.1)$coefficients,
    digits=c(0, 2, 2, 1, 3),
    caption="Error rates model"),
  caption.placement="top", 
  type='html')
```
